<div class="app-container">
  <!-- Fixed Call Header - only show when on call -->
  @if (isOnCall() && currentCall(); as call) {
    <header class="call-header-fixed">
      <div class="call-info">
        <div class="call-basic-info">
          <span class="call-type">{{ call.callType | titlecase }}</span>
          <span class="call-id">{{ call.id }}</span>
          <span class="call-duration">{{ callDuration() }}</span>
        </div>
        @if (call.memberId) {
          <div class="member-status identified">
            <span>Member: {{ call.memberId }}</span>
          </div>
        } @else {
          <div class="member-status pending">
            <span>Identifying member...</span>
          </div>
        }
      </div>
      
      <div class="call-controls">
        <button class="control-btn hold-btn" title="Put call on hold">
          Hold
        </button>
        <button class="control-btn transfer-btn" title="Transfer call">
          Transfer
        </button>
        <button class="control-btn conference-btn" title="Conference call">
          Conference
        </button>
        <button class="control-btn notes-btn" title="Quick note">
          Notes
        </button>
        <button class="control-btn end-call-btn" (click)="onEndCall()" title="End call">
          End Call
        </button>
      </div>
    </header>
  }

  <main class="app-main" [class.with-call-header]="isOnCall()">
    @if (!isLoggedIn()) {
      <!-- Show agent login when not logged in -->
      <section class="login-section">
        <app-agent-login></app-agent-login>
      </section>
    } @else if (!isOnCall()) {
      <!-- Show agent dashboard when logged in but not on call -->
      <section class="dashboard-section">
        <app-agent-dashboard></app-agent-dashboard>
      </section>
    } @else {
      <!-- Show member lookup/details when on call -->
      <section class="member-section">
        @if (!memberIdentified()) {
          <!-- Show member lookup when no member is identified -->
          <app-member-lookup></app-member-lookup>
        } @else {
          <!-- Show member details when member is identified -->
          @if (currentMember(); as member) {
            <app-member-details [member]="member"></app-member-details>
          }
        }
      </section>

      <!-- Show simplified call management (just notes) -->
      <section class="call-notes-section">
        <app-call-management [headerMode]="false"></app-call-management>
      </section>
    }
  </main>

  <footer class="app-footer">
    <p>&copy; 2024 AI Customer Service. All rights reserved.</p>
  </footer>
</div>

<!-- Global Loading Spinner -->
<app-loading-spinner></app-loading-spinner>

<router-outlet></router-outlet>